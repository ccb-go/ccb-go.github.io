import{z,A as De,r as R,B as Re,_ as Se,C as Ne,k as $e,f as M,D as ue,x as Ue,c as A,o as j,g as ke,p as D,a as c,h as $,v as G,E as Ge,F as Ie,j as _e,t as Me,b as Pe,G as ze,H as Be,I as Fe}from"./WFx7aDd1.js";var F,de;function Ce(){if(de)return F;de=1;function t(r){var a=typeof r;return r!=null&&(a=="object"||a=="function")}return F=t,F}var V,ce;function Ve(){if(ce)return V;ce=1;var t=typeof z=="object"&&z&&z.Object===Object&&z;return V=t,V}var W,fe;function Oe(){if(fe)return W;fe=1;var t=Ve(),r=typeof self=="object"&&self&&self.Object===Object&&self,a=t||r||Function("return this")();return W=a,W}var Z,ve;function We(){if(ve)return Z;ve=1;var t=Oe(),r=function(){return t.Date.now()};return Z=r,Z}var H,ge;function Ze(){if(ge)return H;ge=1;var t=/\s/;function r(a){for(var o=a.length;o--&&t.test(a.charAt(o)););return o}return H=r,H}var J,me;function He(){if(me)return J;me=1;var t=Ze(),r=/^\s+/;function a(o){return o&&o.slice(0,t(o)+1).replace(r,"")}return J=a,J}var K,pe;function je(){if(pe)return K;pe=1;var t=Oe(),r=t.Symbol;return K=r,K}var Q,ye;function Je(){if(ye)return Q;ye=1;var t=je(),r=Object.prototype,a=r.hasOwnProperty,o=r.toString,v=t?t.toStringTag:void 0;function x(y){var f=a.call(y,v),n=y[v];try{y[v]=void 0;var d=!0}catch{}var g=o.call(y);return d&&(f?y[v]=n:delete y[v]),g}return Q=x,Q}var Y,we;function Ke(){if(we)return Y;we=1;var t=Object.prototype,r=t.toString;function a(o){return r.call(o)}return Y=a,Y}var X,be;function Qe(){if(be)return X;be=1;var t=je(),r=Je(),a=Ke(),o="[object Null]",v="[object Undefined]",x=t?t.toStringTag:void 0;function y(f){return f==null?f===void 0?v:o:x&&x in Object(f)?r(f):a(f)}return X=y,X}var ee,xe;function Ye(){if(xe)return ee;xe=1;function t(r){return r!=null&&typeof r=="object"}return ee=t,ee}var te,Ee;function Xe(){if(Ee)return te;Ee=1;var t=Qe(),r=Ye(),a="[object Symbol]";function o(v){return typeof v=="symbol"||r(v)&&t(v)==a}return te=o,te}var ne,Te;function et(){if(Te)return ne;Te=1;var t=He(),r=Ce(),a=Xe(),o=NaN,v=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,y=/^0o[0-7]+$/i,f=parseInt;function n(d){if(typeof d=="number")return d;if(a(d))return o;if(r(d)){var g=typeof d.valueOf=="function"?d.valueOf():d;d=r(g)?g+"":g}if(typeof d!="string")return d===0?d:+d;d=t(d);var E=x.test(d);return E||y.test(d)?f(d.slice(2),E?2:8):v.test(d)?o:+d}return ne=n,ne}var re,he;function tt(){if(he)return re;he=1;var t=Ce(),r=We(),a=et(),o="Expected a function",v=Math.max,x=Math.min;function y(f,n,d){var g,E,C,w,b,T,I=0,O=!1,s=!1,m=!0;if(typeof f!="function")throw new TypeError(o);n=a(n)||0,t(d)&&(O=!!d.leading,s="maxWait"in d,C=s?v(a(d.maxWait)||0,n):C,m="trailing"in d?!!d.trailing:m);function p(e){var i=g,N=E;return g=E=void 0,I=e,w=f.apply(N,i),w}function l(e){return I=e,b=setTimeout(S,n),O?p(e):w}function h(e){var i=e-T,N=e-I,P=n-i;return s?x(P,C-N):P}function _(e){var i=e-T,N=e-I;return T===void 0||i>=n||i<0||s&&N>=C}function S(){var e=r();if(_(e))return k(e);b=setTimeout(S,h(e))}function k(e){return b=void 0,m&&g?p(e):(g=E=void 0,w)}function q(){b!==void 0&&clearTimeout(b),I=0,g=T=E=b=void 0}function U(){return b===void 0?w:k(r())}function u(){var e=r(),i=_(e);if(g=arguments,E=this,T=e,i){if(b===void 0)return l(T);if(s)return clearTimeout(b),b=setTimeout(S,n),p(T)}return b===void 0&&(b=setTimeout(S,n)),w}return u.cancel=q,u.flush=U,u}return re=y,re}var nt=tt();const rt=De(nt),at="865568496873-o4enb1hhvpmj2unq7v9n6dcg94h5itp6.apps.googleusercontent.com",ot="",it="https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest",st="https://www.googleapis.com/auth/calendar";let B;function lt(t){typeof window<"u"&&window.localStorage&&window.localStorage.setItem("googleAuthToken",JSON.stringify(t))}function ae(){if(typeof window<"u"&&window.localStorage){const t=window.localStorage.getItem("googleAuthToken");return t?JSON.parse(t):null}return null}function ut(){typeof window<"u"&&window.localStorage&&window.localStorage.removeItem("googleAuthToken")}async function dt(t){try{const r=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t}`}});return r.ok?await r.json():null}catch{return null}}async function qe(){let t=0;for(;(typeof window>"u"||!window.gapi||!window.google)&&t<20;)await new Promise(a=>setTimeout(a,100)),t++;if(typeof window>"u"||!window.gapi||!window.google)throw new Error("Google API não carregada. Verifique se o script do Google API foi incluído.");await new Promise(a=>{window.gapi.load("client",a)}),await window.gapi.client.init({apiKey:ot,discoveryDocs:[it]}),B=window.google.accounts.oauth2.initTokenClient({client_id:at,scope:st,callback:""});const r=ae();r&&r.access_token&&window.gapi.client.setToken(r)}function ct(){var r,a,o;const t=(o=(a=(r=window.gapi)==null?void 0:r.client)==null?void 0:a.getToken)==null?void 0:o.call(a);return!!(t!=null&&t.access_token)}async function ft(t,r){B||await qe(),B.callback=async a=>{if(a.error){r&&r(a);return}const o=await dt(a.access_token);console.log("User info tokennnn::::",o);const v={...a,user:(o==null?void 0:o.name)||"",email:(o==null?void 0:o.email)||"",expires_in:a.expires_in,expires_at:Date.now()+(a.expires_in?a.expires_in*1e3:0),rawUserInfo:o||{}};lt(v),t&&t(v)},B.requestAccessToken({prompt:"consent"})}function vt(){var r,a,o;const t=(o=(a=(r=window.gapi)==null?void 0:r.client)==null?void 0:a.getToken)==null?void 0:o.call(a);t&&(window.google.accounts.oauth2.revoke(t.access_token),window.gapi.client.setToken(""),ut())}function gt(){const t=ae();return(t==null?void 0:t.user)||(t==null?void 0:t.email)||""}function mt(){const t=ae();return(t==null?void 0:t.email)||""}async function pt(){return(await window.gapi.client.calendar.calendarList.list()).result.items||[]}async function yt(t,r={}){var x;const a=new Date().toISOString(),o=[];let v;do{const y={calendarId:t,timeMin:r.timeMin||a,showDeleted:!1,singleEvents:!0,maxResults:r.maxResults||100,orderBy:"startTime",...v&&{pageToken:v},...r.timeMax&&{timeMax:r.timeMax}},{result:f}=await window.gapi.client.calendar.events.list(y);(x=f==null?void 0:f.items)!=null&&x.length&&o.push(...f.items),v=f.nextPageToken}while(v);return o}async function wt(t,r){return window.gapi.client.calendar.events.insert({calendarId:t,resource:r})}async function bt(t,r,a){return window.gapi.client.calendar.events.update({calendarId:t,eventId:r,resource:a})}async function xt(t,r){return window.gapi.client.calendar.events.delete({calendarId:t,eventId:r})}const L={init:qe,isSignedIn:ct,signIn:ft,signOut:vt,listCalendars:pt,listEvents:yt,createEvent:wt,updateEvent:bt,deleteEvent:xt,getUserName:gt,getUserEmail:mt};function Le(){const t=R(!1),r=R(!1),a=R(""),o=R("");return{isSignedIn:t,isLoadingAuth:r,error:a,userName:o,initializeAuth:async()=>{try{await L.init(),t.value=L.isSignedIn(),o.value=L.getUserName?L.getUserName():"",window.google&&window.google.accounts&&window.google.accounts.id&&window.google.accounts.id.prompt(void 0,{auto_select:!0})}catch(f){a.value=`Erro ao inicializar Google API: ${f.message||f}`}},handleAuthClick:async()=>{r.value=!0,L.signIn(async()=>{r.value=!1,t.value=!0,o.value=L.getUserName?L.getUserName():""},()=>{r.value=!1,a.value="Erro de autorização: verifique o CLIENT_ID"})},handleSignoutClick:()=>{L.signOut(),t.value=!1,o.value=""},googleCalendarService:L}}function Ae(){const{isSignedIn:t,isLoadingAuth:r,error:a,userName:o,initializeAuth:v,handleAuthClick:x,handleSignoutClick:y,googleCalendarService:f}=Le(),n=R(!1),d=R(""),g=Re([]),E=async(s={})=>{try{await v(),t.value&&await C(s)}catch(m){d.value=`Erro ao inicializar Google API: ${m.message||m}`}},C=async(s={})=>{n.value=!0,d.value="",g.splice(0);try{const m=await f.listCalendars();console.log("Calendários retornados:",m);let p=m;s.calendarIds&&(p=m.filter(l=>s.calendarIds.includes(l.id)||s.calendarIds.includes(l.summary)));for(const l of p)g.push({id:l.id,summary:l.summary,events:[],isLoadingEvents:!0,eventsError:"",isDeleting:!1,timeZone:l.timeZone,backgroundColor:l.backgroundColor,foregroundColor:l.foregroundColor});await Promise.all(g.map(async l=>{await w(l,s),console.log(`Eventos do calendário ${l.summary}:`,l.events)}))}catch(m){d.value=`Erro ao buscar calendários: ${m.message||m}`}finally{n.value=!1}},w=async(s,m={})=>{try{s.events=await f.listEvents(s.id,m),s.isLoadingEvents=!1}catch(p){s.eventsError=`Erro ao buscar eventos: ${p.message||p}`,s.isLoadingEvents=!1}},b=async(s,m)=>{let p,l;typeof m>"u"&&s&&s.calendarId?(l=s,p=l.calendarId):(p=s,l=m);try{const h=O(l);l.location&&(h.location=l.location);const _=await f.updateEvent(p,l.id,h),S=g.find(k=>k.id===p);if(S&&_){const k=S.events.findIndex(q=>q.id===l.id);k!==-1&&(S.events[k]={...S.events[k],..._})}console.info("Evento atualizado",l,_)}catch(h){console.warn("Erro ao atualizar evento:",h)}},T=async(s,m)=>{try{const p=await f.createEvent(s,O(m)),l=g.find(h=>h.id===s);l&&p&&l.events.push({...p}),console.info("Evento criado")}catch(p){console.warn(`Erro ao criar evento: ${p.message||p}`)}},I=async(s,m)=>{const p=g.find(l=>l.id===s);if(p){p.isDeleting=!0;try{await f.deleteEvent(s,m);const l=p.events.findIndex(h=>h.id===m);l!==-1&&p.events.splice(l,1),console.info("Evento apagado")}catch(l){console.warn(`Erro ao apagar evento: ${l.message||l}`)}finally{p.isDeleting=!1}}},O=s=>{const m=s.summary||s.title||"",p=s.description||"",l=h=>{if(!h)return"";const _=new Date(h),S=-_.getTimezoneOffset(),k=S>=0?"+":"-",q=u=>String(Math.floor(Math.abs(u))).padStart(2,"0"),U=k+q(S/60)+":"+q(S%60);return _.toISOString().slice(0,19)+U};return{summary:m,description:p,start:{dateTime:l(s.startEvent||s.start)},end:{dateTime:l(s.endEvent||s.end)}}};return{isSignedIn:t,isLoading:n,isLoadingAuth:r,error:d,authError:a,calendars:g,handleAuthClick:x,handleSignoutClick:y,editEvent:b,createEvent:T,deleteEvent:I,initialize:E,userName:o}}const Et={key:1,class:"grid grid-cols-1 sm:grid-cols-4 gap-4 p-4"},Tt={class:"flex flex-col text-sm text-gray-700 col-span-4 sm:col-span-1"},ht={class:"relative"},St={class:"flex flex-col text-sm text-gray-700 col-span-4 sm:col-span-1"},kt={class:"relative"},It=["value"],_t={class:"flex flex-col text-sm text-gray-700 col-span-4 sm:col-span-1"},Ct={class:"relative"},Ot={class:"flex flex-col text-sm text-gray-700 col-span-4 sm:col-span-1"},jt={class:"relative"},qt={key:2,class:"grid grid-cols-1 sm:grid-cols-4 gap-4 p-4 pt-0"},Lt={class:"flex flex-col text-sm text-gray-700 col-span-4 sm:col-span-1"},At={class:"relative"},Dt={class:"flex flex-col text-sm text-gray-700 col-span-4 sm:col-span-2"},Rt={id:"date-range-picker",class:"flex items-center gap-4"},Nt={class:"relative flex-1"},$t={class:"relative flex-1"},Ut={__name:"ListaEditFilterBar",emits:["update:filters","update:filteredEventos"],setup(t,{emit:r}){var l,h,_,S,k,q,U;const a=r,o=Ne(),v=$e();function x(){const u=new Date,e=new Date;return e.setDate(u.getDate()+70),{today:u.toISOString().split("T")[0],future:e.toISOString().split("T")[0]}}const{today:y,future:f}=x(),n=R({list:((l=o.query)==null?void 0:l.list)||"",title:((h=o.query)==null?void 0:h.title)||"",locale:((_=o.query)==null?void 0:_.locale)||"",search:((S=o.query)==null?void 0:S.search)||"",date:((k=o.query)==null?void 0:k.date)||"",start:((q=o.query)==null?void 0:q.start)||y,end:((U=o.query)==null?void 0:U.end)||f}),d=rt(()=>{const u=Object.fromEntries(Object.entries(n.value).filter(([e,i])=>i!==""&&i!==null&&i!==void 0));v.replace({query:u})},300);function g(u,e){n.value[u]=e,d(),a("update:filters",{...n.value}),a("update:filteredEventos",s.value)}const{calendars:E,initialize:C}=Ae(),{isSignedIn:w,handleAuthClick:b}=Le(),T=M(()=>{const u=new Set;return E.filter(e=>!e.id||u.has(e.id)?!1:(u.add(e.id),!0))});function I(u){if(!u)return"";const e=new Date(u);return u.length>10?e.toISOString().slice(0,16):e.toISOString().slice(0,10)}const O=M(()=>{const u=E.flatMap(e=>(e.events||[]).map(i=>{var N,P,oe,ie,se,le;return{...i,calendarId:e.id,calendarSummary:e.summary,startEvent:I(((N=i.start)==null?void 0:N.dateTime)||((P=i.start)==null?void 0:P.date)),endEvent:I(((oe=i.end)==null?void 0:oe.dateTime)||((ie=i.end)==null?void 0:ie.date)),title:i.summary||"",locale:i.location||"",description:(i==null?void 0:i.description)||"",date:(((se=i.start)==null?void 0:se.dateTime)||((le=i.start)==null?void 0:le.date)||"").slice(0,10),list:e.id}}));return console.log("Todos os calendários:",E),console.log("Todos os eventos:",u),u}),s=M(()=>O.value.filter(u=>{if(n.value.list&&u.calendarId!==n.value.list||n.value.title&&!u.title.toLowerCase().includes(n.value.title.toLowerCase())||n.value.locale&&(!u.locale||!u.locale.toLowerCase().includes(n.value.locale.toLowerCase()))||n.value.date&&u.date!==n.value.date||n.value.start&&n.value.end&&(u.date<n.value.start||u.date>n.value.end))return!1;if(n.value.search){const e=n.value.search.toLowerCase();if(!(u.title&&u.title.toLowerCase().includes(e))&&!(u.locale&&u.locale.toLowerCase().includes(e))&&!(u.description&&u.description.toLowerCase().includes(e)))return!1}return!0}));function m(u){n.value[u.key]="",d(),a("update:filters",{...n.value}),a("update:filteredEventos",s.value)}function p(){n.value.start=y,n.value.end=f,d(),a("update:filters",{...n.value}),a("update:filteredEventos",s.value)}return ue(()=>n.value,()=>{a("update:filters",{...n.value}),a("update:filteredEventos",s.value)},{deep:!0}),Ue(async()=>{w.value&&await C({timeMin:n.value.start+"T00:00:00Z",timeMax:n.value.end+"T23:59:59Z",singleEvents:!0,maxResults:1e4,orderBy:"startTime"}),a("update:filters",{...n.value}),a("update:filteredEventos",s.value)}),ue(()=>w.value,async u=>{u&&(await C({timeMin:n.value.start+"T00:00:00Z",timeMax:n.value.end+"T23:59:59Z",singleEvents:!0,maxResults:1e4,orderBy:"startTime"}),a("update:filters",{...n.value}),a("update:filteredEventos",s.value))}),(u,e)=>(j(),A("div",null,[D(w).value?(j(),A("div",Et,[c("div",Tt,[e[19]||(e[19]=c("label",{class:"font-medium"},"Pesquisar:",-1)),c("div",ht,[$(c("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>n.value.search=i),type:"text",class:"w-full border rounded-md px-3 py-1 pr-8 focus:ring focus:ring-blue-200",onInput:e[2]||(e[2]=i=>g("search",n.value.search))},null,544),[[G,n.value.search]]),c("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-500",onClick:e[3]||(e[3]=i=>m({key:"search"}))}," × ")])]),c("div",St,[e[21]||(e[21]=c("label",{class:"font-medium"},"Lista:",-1)),c("div",kt,[$(c("select",{"onUpdate:modelValue":e[4]||(e[4]=i=>n.value.list=i),class:"w-full border rounded-md px-3 py-1 pr-8 focus:ring focus:ring-blue-200",onChange:e[5]||(e[5]=i=>g("list",n.value.list))},[e[20]||(e[20]=c("option",{value:""},"Selecione",-1)),(j(!0),A(Ie,null,_e(T.value,i=>(j(),A("option",{key:i.id,value:i.id},Me(i.summary),9,It))),128))],544),[[Ge,n.value.list]])])]),c("div",_t,[e[22]||(e[22]=c("label",{class:"font-medium"},"Título:",-1)),c("div",Ct,[$(c("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>n.value.title=i),type:"text",class:"w-full border rounded-md px-3 py-1 pr-8 focus:ring focus:ring-blue-200",onInput:e[7]||(e[7]=i=>g("title",n.value.title))},null,544),[[G,n.value.title]]),c("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-500",onClick:e[8]||(e[8]=i=>m({key:"title"}))}," × ")])]),c("div",Ot,[e[23]||(e[23]=c("label",{class:"font-medium"},"Local:",-1)),c("div",jt,[$(c("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>n.value.locale=i),type:"text",class:"w-full border rounded-md px-3 py-1 pr-8 focus:ring focus:ring-blue-200",onInput:e[10]||(e[10]=i=>g("locale",n.value.locale))},null,544),[[G,n.value.locale]]),c("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-500",onClick:e[11]||(e[11]=i=>m({key:"locale"}))}," × ")])])])):(j(),A("button",{key:0,class:"auth-button",onClick:e[0]||(e[0]=(...i)=>D(b)&&D(b)(...i))}," Entrar com Google ")),D(w).value?(j(),A("div",qt,[c("div",Lt,[e[24]||(e[24]=c("label",{class:"font-medium"},"Data:",-1)),c("div",At,[$(c("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>n.value.date=i),type:"date",class:"w-full border rounded-md px-3 py-1 pr-8 focus:ring focus:ring-blue-200",onInput:e[13]||(e[13]=i=>g("date",n.value.date))},null,544),[[G,n.value.date]]),c("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-red-500",onClick:e[14]||(e[14]=i=>m({key:"date"}))}," × ")])]),c("div",Dt,[e[26]||(e[26]=c("label",{class:"font-medium"},"Intervalo de Datas:",-1)),c("div",Rt,[c("div",Nt,[$(c("input",{id:"datepicker-range-start","onUpdate:modelValue":e[15]||(e[15]=i=>n.value.start=i),type:"date",class:"w-full border rounded-md px-3 py-1 focus:ring focus:ring-blue-200",onInput:e[16]||(e[16]=i=>g("start",n.value.start))},null,544),[[G,n.value.start]])]),e[25]||(e[25]=c("span",{class:"text-gray-500"},"até",-1)),c("div",$t,[$(c("input",{id:"datepicker-range-end","onUpdate:modelValue":e[17]||(e[17]=i=>n.value.end=i),type:"date",class:"w-full border rounded-md px-3 py-1 focus:ring focus:ring-blue-200",onInput:e[18]||(e[18]=i=>g("end",n.value.end))},null,544),[[G,n.value.end]])]),c("button",{class:"text-gray-500 hover:text-red-500",onClick:p}," × ")])])])):ke("",!0)]))}},Gt=Se(Ut,[["__scopeId","data-v-3e2ade3b"]]),Mt={class:"container"},Pt={class:"content"},zt={key:0,class:"no-data"},Bt={__name:"agenda",setup(t){const{isLoading:r,error:a,editEvent:o,createEvent:v,deleteEvent:x}=Ae(),y=R([]),f=R({});function n(w){f.value=w}function d(w){y.value=w}const g=M(()=>y.value.reduce((w,b)=>{const T=b.summary||b.title||"";return w[T]||(w[T]=[]),w[T].push(b),w},{})),E=M(()=>f.value.start),C=M(()=>f.value.end);return(w,b)=>{const T=Be("ListaAgendaEdit");return j(),A("div",Mt,[Pe(Gt,{"onUpdate:filters":n,"onUpdate:filteredEventos":d}),$(c("div",Pt,[y.value.length===0?(j(),A("div",zt," Nenhum evento encontrado. ")):ke("",!0),(j(!0),A(Ie,null,_e(g.value,(I,O)=>(j(),Fe(T,{key:O,title:O,eventos:I,start:E.value,end:C.value,onEditEvent:D(o),onAddEvent:D(v),onDeleteEvent:D(x)},null,8,["title","eventos","start","end","onEditEvent","onAddEvent","onDeleteEvent"]))),128))],512),[[ze,!D(r)&&!D(a)]])])}}},Vt=Se(Bt,[["__scopeId","data-v-1303ae4e"]]);export{Vt as default};
