import G from"./D9ulxedu.js";import{_ as ae,r as F,x as de,D as N,c as w,g as M,o as v,h as I,a as t,v as O,q as le,s as H,y as oe,p as d,b as T,I as R,J as pe,w as me,n as U,t as A,T as fe,K as ie,C as ue,k as ge,L as X,E as ce,F as q,j as B,M as ve,e as ee,B as te,f as j,N as ye,O as be,P as $e,i as W,l as Q,G as K}from"./WFx7aDd1.js";import{E as he,a as _e,S as Ee}from"./D-oN5_bh.js";import{S as J}from"./DDcXZwF0.js";const we={key:0,class:"space-y-4 max-w-md mx-auto"},De={__name:"git",setup(L,{expose:b}){const g=F(""),o=F(""),$=F(""),c=F(!1);de(()=>{const h=localStorage.getItem("git_config");if(h)try{const s=JSON.parse(atob(h));g.value=s.token||"",o.value=s.repoOwner||"",$.value=s.repoName||""}catch(s){console.log("Erro::: ",s)}c.value=!0}),N([g,o,$],()=>{const h={token:g.value,repoOwner:o.value,repoName:$.value};localStorage.setItem("git_config",btoa(JSON.stringify(h)))},{deep:!0});const _=()=>({Authorization:`Bearer ${g.value}`,"Content-Type":"application/json; charset=UTF-8",Accept:"application/vnd.github.v3+json"}),D=async h=>{var u;const s=`https://api.github.com/repos/${o.value}/${$.value}/contents/${h}`,{data:e,error:l}=await le(s,{method:"GET",headers:_(),pick:["content","sha"],watch:!1},"$9xe66jx9KU");if(l.value)throw new Error(`Erro ao buscar: ${((u=l.value.data)==null?void 0:u.message)||l.value.message}`);return{content:Buffer.from(e.value.content,"base64").toString("utf-8"),sha:e.value.sha}},S=async(h,s)=>{var a;console.log("Solicitacao de atualizacao:: ",h,s);const e=`https://api.github.com/repos/${o.value}/${$.value}/contents/${s}`,l=_();let i=null;try{const p=await D(s);if(p.content===h)return console.info("GIT: Conteúdo idêntico."),!1;i=p.sha}catch(p){if(!p.message.includes("404"))throw p;console.log("GIT: Arquivo será criado.")}const u={message:i?"Atualização via Nuxt":"Criação via Nuxt",content:Buffer.from(h,"utf-8").toString("base64"),...i&&{sha:i}},{error:r}=await le(e,{method:"PUT",headers:l,body:u,watch:!1},"$aH25C_JKj4");if(r.value)throw new Error(`Erro ao enviar: ${((a=r.value.data)==null?void 0:a.message)||r.value.message}`);return console.log("GIT: Enviado com sucesso!"),!0},C=async()=>{await S(`# Atualizado em ${new Date().toISOString()}`,"README.md")};return b({getFile:D,pushFile:S}),(h,s)=>c.value?(v(),w("div",we,[I(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>g.value=e),type:"password",placeholder:"Token",class:"input"},null,512),[[O,g.value]]),I(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>o.value=e),placeholder:"Owner",class:"input"},null,512),[[O,o.value]]),I(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>$.value=e),placeholder:"Repo",class:"input"},null,512),[[O,$.value]]),t("button",{class:"btn",onClick:C},"Sync")])):M("",!0)}},ke=ae(De,[["__scopeId","data-v-adc87aea"]]),xe={class:"container"},Ie={key:0},Se={class:"dropdown-content"},Te={class:"dropdown-avatar-container"},Oe={class:"countdown"},Ae={key:1},Z=!1,Me={__name:"auth",setup(L){const{auth:b}=H(),{$toast:g}=oe(),o=F(!1),$=F(!1),c=F(!1);function _(){o.value=!o.value}function D(){o.value=!1}async function S(){const e=()=>g.success("Conectando"),l=i=>g.error("Erro ao conectar: "+i);try{await g.promise(b.signIn({callback:e,errorCallback:l}),{pending:"Conectando...",success:"Janela de solicitação aberta!",error:"Erro ao conectar."})}catch(i){console.error("Erro ao fazer login:",i),l(i)}}async function C(){try{const e=()=>{g.success("Até logo!",{duration:2e3,position:"top-right"}),D()},l=i=>g.error("Erro ao desconectar: "+i);await b.signOut(e,l)}catch(e){g.error("Erro ao fazer logout: "+e)}}const h=e=>e>0?[e/3600,e%3600/60,e%60].map(l=>String(Math.floor(l)).padStart(2,"0")).join(":"):"00:00:00",s=pe({props:{src:{type:String,default:""},alt:{type:String,default:""},fallback:{type:String,default:""},hovered:Boolean,size:{type:Number,default:2.5},border:{type:String,default:"#d1d5db"}},setup(e){const l=F(!1);return()=>l.value?ie("div",{class:"avatar-fallback",style:{width:`${e.size}rem`,height:`${e.size}rem`,borderRadius:"9999px",border:`2px solid ${e.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:"#e5e7eb",color:"#111827",fontSize:e.size===4?"2rem":"1.25rem",fontWeight:600,transition:"border-color 0.2s"},class:{"avatar-hovered":e.hovered}},e.fallback):ie("img",{src:e.src,alt:e.alt,class:"avatar",style:{width:`${e.size}rem`,height:`${e.size}rem`,borderRadius:"9999px",border:`2px solid ${e.border}`,transition:"border-color 0.2s"},class:{"avatar-hovered":e.hovered},onError:()=>l.value=!0})}});return(e,l)=>(v(),w("div",xe,[d(b).user.token?(v(),w("div",Ie,[t("div",{class:"avatar-container",onClick:_,onMouseover:l[0]||(l[0]=i=>$.value=!0),onMouseleave:l[1]||(l[1]=i=>$.value=!1)},[(v(),R(d(s),{key:d(b).user.picture,src:d(b).user.picture,alt:d(b).user.name,fallback:d(b).user.name.charAt(0).toUpperCase(),hovered:$.value,size:2.5},null,8,["src","alt","fallback","hovered"]))],32),T(fe,{name:"fade"},{default:me(()=>[o.value?(v(),w("div",{key:0,class:U(["dropdown",{"dropdown-dark":Z}])},[t("div",Se,[t("div",Te,[(v(),R(d(s),{key:d(b).user.picture,src:d(b).user.picture,alt:d(b).user.name,fallback:d(b).user.name.charAt(0).toUpperCase(),size:4,border:"#3b82f6"},null,8,["src","alt","fallback"]))]),t("div",{class:U(["user-name",{"user-name-dark":Z}])},A(d(b).user.name),3),t("div",{class:U(["user-email",{"user-email-dark":Z}])},A(d(b).user.email),3),t("button",{class:U(["signout-button",{"signout-button-hovered":c.value}]),onClick:C,onMouseover:l[2]||(l[2]=i=>c.value=!0),onMouseleave:l[3]||(l[3]=i=>c.value=!1)},[l[4]||(l[4]=t("span",null,"Sair",-1)),t("span",Oe,A(h(d(b).user.expires_countdown)),1)],34)])],2)):M("",!0)]),_:1}),o.value?(v(),w("div",{key:0,class:"overlay",onClick:D})):M("",!0)])):(v(),w("div",Ae,[t("button",{class:"gsi-material-button",type:"button",onClick:S},l[5]||(l[5]=[t("div",{class:"gsi-material-button-state"},null,-1),t("div",{class:"gsi-material-button-content-wrapper"},[t("div",{class:"gsi-material-button-icon"}),t("span",{class:"gsi-material-button-contents"},"Entrar com Google")],-1)]))]))]))}},Ce=ae(Me,[["__scopeId","data-v-fd966e2c"]]),Fe={class:"form-inline"},Ue={class:"form-group"},Le={class:"row"},Re={class:"form-group"},ze={class:"row"},Ne={class:"form-group"},Ve={class:"row"},Ye=["value"],je={class:"form-group"},qe={class:"flex gap-xs"},Be={class:"form-group"},Ge={class:"flex gap-xs"},He={class:"form-group",style:{"align-items":"flex-start"}},We=["id","value"],Ke=["for"],Pe={class:"form-group",style:{"text-align":"right"}},Qe=["disabled"],Je={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Ze={__name:"filters-agenda",setup(L){const b=ue(),g=ge(),{agenda:o,auth:$}=H(),{$toast:c}=oe(),_=F(!1),D={formatISOToInput(r){if(!r)return"";const a=new Date(r);return r.length>10?a.toISOString().slice(0,16):a.toISOString().slice(0,10)},getDefaultDates(){const r=new Date,a=new Date;return a.setDate(r.getDate()+70),{today:this.formatISOToInput(r),future:this.formatISOToInput(a)}},getFriendlyErrorMessage(r){var p,E,k,x;const a=((E=(p=r==null?void 0:r.result)==null?void 0:p.error)==null?void 0:E.message)||(r==null?void 0:r.message)||(r==null?void 0:r.toString())||"";return a.includes("Request is missing required authentication credential")?"Sua sessão expirou. Por favor, faça login novamente para acessar os eventos.":`Erro (${((x=(k=r==null?void 0:r.result)==null?void 0:k.error)==null?void 0:x.code)||""}) ao carregar eventos: ${a}`},sleep(r){return new Promise(a=>setTimeout(a,r))}},{today:S,future:C}=D.getDefaultDates();(()=>{const r=b.query||{};if(r.calendar){const a=Array.isArray(r.calendar)?r.calendar:r.calendar.split(",").filter(Boolean);o.filters.calendarIDs=a}else o.filters.calendarIDs=[];o.filters.title=r.title||"",o.filters.locale=r.locale||"",o.filters.search=r.search||"",o.filters.date=r.date||"",o.filters.start=r.start||S,o.filters.end=r.end||C})();const s=X(()=>{const r=Object.fromEntries(Object.entries(o.filters).filter(([a,p])=>a==="calendarIDs"?Array.isArray(p)&&p.length>0:p!==""&&p!==null&&p!==void 0).map(([a,p])=>a==="calendarIDs"&&Array.isArray(p)?["calendar",p.join(",")]:[a,p]));g.replace({query:{...r}})},300);function e(r){o.filters[r]="",r==="date"&&(o.filters.start=D.formatISOToInput(S),o.filters.end=D.formatISOToInput(C)),r==="calendarIDs"&&(o.filters.calendarIDs=[]),s()}async function l(){var r,a,p,E,k,x;try{if(window&&!((a=(r=window==null?void 0:window.gapi)==null?void 0:r.client)!=null&&a.calendar)){c.error("Google Calendar API não está disponível. Faça login ou aguarde o carregamento.");return}await D.sleep(200),await c.promise(o.fetchGoogleCalendars(),{pending:"Carregando eventos...",success:"Eventos carregados com sucesso!",error:{render({data:m}){return D.getFriendlyErrorMessage(m)}}})}catch(m){c.error(D.getFriendlyErrorMessage(m)),console.error(`Erro (${(E=(p=m.result)==null?void 0:p.error)==null?void 0:E.code}) ao carregar eventos: ${(x=(k=m.result)==null?void 0:k.error)==null?void 0:x.message}`,m)}finally{_.value=!1}}async function i(){await o.fetchGoogleEvents()}const u=X(async()=>{try{_.value=!0,await o.awaitGapi(),await l(),await i()}catch{c.error("Google Calendar API não foi carregada. Tente recarregar a página ou aguarde.")}finally{_.value=!1}},400);return N(()=>$.user.token,async r=>{r&&u()},{immediate:!0}),de(()=>{u()}),N(()=>({...o.filters}),()=>{s()},{deep:!0}),(r,a)=>{var E,k,x;const p=G;return v(),w("div",null,[T(Ce,{style:{"margin-bottom":"8px"}}),t("div",Fe,[t("div",null,[t("div",Ue,[a[11]||(a[11]=t("label",{for:"search",class:"text-sm font-medium text-gray-700 mb-1"},"Pesquisar",-1)),t("div",Le,[I(t("input",{id:"search","onUpdate:modelValue":a[0]||(a[0]=m=>d(o).filters.search=m),type:"text",placeholder:"Buscar eventos..."},null,512),[[O,d(o).filters.search]]),d(o).filters.search?(v(),w("button",{key:0,"aria-label":"Limpar pesquisa",type:"button",onClick:a[1]||(a[1]=m=>e("search"))}," × ")):M("",!0)])]),t("div",Re,[a[12]||(a[12]=t("label",{for:"title",class:"text-sm font-medium text-gray-700 mb-1"},"Título",-1)),t("div",ze,[I(t("input",{id:"title","onUpdate:modelValue":a[2]||(a[2]=m=>d(o).filters.title=m),type:"text",placeholder:"Filtrar por título..."},null,512),[[O,d(o).filters.title]]),d(o).filters.title?(v(),w("button",{key:0,"aria-label":"Limpar título",type:"button",onClick:a[3]||(a[3]=m=>e("title"))}," × ")):M("",!0)])]),t("div",Ne,[a[14]||(a[14]=t("label",{for:"locale",class:"text-sm font-medium text-gray-700 mb-1"},"Local",-1)),t("div",Ve,[I(t("select",{id:"locale","onUpdate:modelValue":a[4]||(a[4]=m=>d(o).filters.locale=m)},[a[13]||(a[13]=t("option",{value:""},"Todos os locais",-1)),(v(!0),w(q,null,B(d(o).eventsLocales,m=>(v(),w("option",{key:m,value:m},A(m),9,Ye))),128))],512),[[ce,d(o).filters.locale]]),d(o).filters.locale?(v(),w("button",{key:0,"aria-label":"Limpar local",type:"button",onClick:a[5]||(a[5]=m=>e("locale"))}," × ")):M("",!0)])]),t("div",je,[a[15]||(a[15]=t("label",{for:"date",class:"text-sm font-medium text-gray-700 mb-1"},"Data",-1)),t("div",qe,[I(t("input",{id:"date","onUpdate:modelValue":a[6]||(a[6]=m=>d(o).filters.date=m),type:"date"},null,512),[[O,d(o).filters.date]]),d(o).filters.date?(v(),w("button",{key:0,"aria-label":"Limpar data",type:"button",onClick:a[7]||(a[7]=m=>e("date"))}," × ")):M("",!0)])]),t("div",Be,[a[16]||(a[16]=t("label",null,"Intervalo de Datas",-1)),t("div",Ge,[I(t("input",{id:"datepicker-range-start","onUpdate:modelValue":a[8]||(a[8]=m=>d(o).filters.start=m),type:"date"},null,512),[[O,d(o).filters.start]]),I(t("input",{id:"datepicker-range-end","onUpdate:modelValue":a[9]||(a[9]=m=>d(o).filters.end=m),type:"date"},null,512),[[O,d(o).filters.end]])])])]),t("div",null,[t("div",He,[a[17]||(a[17]=t("label",null,"Calendários",-1)),t("div",null,[(v(!0),w(q,null,B(d(o).calendars,m=>(v(),w("div",{key:m.id,style:{"margin-bottom":"2px"}},[I(t("input",{id:"calendar-"+m.id,"onUpdate:modelValue":a[10]||(a[10]=z=>d(o).filters.calendarIDs=z),type:"checkbox",value:m.id,style:{margin:"5px 5px 0 0"}},null,8,We),[[ve,d(o).filters.calendarIDs]]),t("label",{for:"calendar-"+m.id,style:{"margin-bottom":"0"}},A(m.summary),9,Ke)]))),128))])]),t("div",Pe,[a[18]||(a[18]=t("label",null,null,-1)),t("button",{class:"success",disabled:d(_)||d(o).loading,onClick:i},A(d(_)||d(o).loading?"Atualizando...":"Aplicar"),9,Qe)])])]),t("div",Je,[t("span",null,[T(p,{name:"la:calendar-check"}),ee(" "+A((k=(E=d(o))==null?void 0:E.calendars)==null?void 0:k.length),1)]),t("span",null,[T(p,{name:"la:tasks"}),ee(" "+A((x=d(o).eventsFiltered)==null?void 0:x.length),1)])])])}}},Xe={style:{"max-width":"297mm",margin:"0 auto"}},et={colspan:"8"},tt=["onDblclick"],at={class:"tooltip","data-tooltip":"Data fim"},ot=["onUpdate:modelValue","onFocusout"],rt={class:"tooltip print-hide","data-tooltip":"Data fim"},st=["onUpdate:modelValue","min","onFocusout"],nt=["onFocusout"],lt=["onFocusout"],it={class:"print-hide"},dt=["onClick"],ut={__name:"edit",setup(L){const{agenda:b,lista:g}=H(),o=te({}),$={formatISOToInput(s){if(!s)return"";const e=new Date(s),l=i=>i.toString().padStart(2,"0");return s.length>10?`${e.getFullYear()}-${l(e.getMonth()+1)}-${l(e.getDate())}T${l(e.getHours())}:${l(e.getMinutes())}`:`${e.getFullYear()}-${l(e.getMonth()+1)}-${l(e.getDate())}`}},c={grouped:j(()=>{const s=g.titles||[],e=(b.eventsFiltered||[]).reduce((i,u)=>{var a,p,E,k;const r=u.summary||u.title||"";return i[r]||(i[r]=[]),i[r].push({...u,startEvent:$.formatISOToInput(((a=u.start)==null?void 0:a.dateTime)||((p=u.start)==null?void 0:p.date)),endEvent:$.formatISOToInput(((E=u.end)==null?void 0:E.dateTime)||((k=u.end)==null?void 0:k.date))}),i},{}),l={};return s.forEach(i=>{e[i]&&(l[i]=e[i])}),Object.keys(e).forEach(i=>{l[i]||(l[i]=e[i])}),l}),_debouncers:{},handleEdit(s,e,l){if(l!==(s[e]||"")){const i=`${s.id}_${e}`;o[s.id]=!0,this._debouncers[i]||(this._debouncers[i]=X((u,r,a)=>{const p={summary:r==="summary"?a:u.summary,location:r==="location"?a:u.location,description:r==="description"?a:u.description,start:u.start,end:u.end},E=u.calendarId;b.updateGoogleEvent(E,u.id,p).then(()=>{o[u.id]=!1}).catch(k=>{o[u.id]=!1,console.warn("Erro ao editar evento:",k)})},3e3)),this._debouncers[i](s,e,l)}},updateDate(s,e,l){var u,r;if($.formatISOToInput(((u=s.start)==null?void 0:u.dateTime)||((r=s.start)==null?void 0:r.date))!==l){o[s.id]=!0;let a=s.start,p=s.end;const E=Intl.DateTimeFormat().resolvedOptions().timeZone;if(e==="startEvent"){const x=new Date(l),m=new Date(x.getTime()+2*60*60*1e3);m.setMinutes(0,0,0),a={...a,dateTime:x.toISOString(),timeZone:E},p={...p,dateTime:m.toISOString(),timeZone:E}}else if(e==="endEvent"){const x=new Date(l);p={...p,dateTime:x.toISOString(),timeZone:E}}const k={summary:s.summary,location:s.location,description:s.description,start:a,end:p};b.updateGoogleEvent(s.calendarId,s.id,k).then(x=>{o[s.id]=!1,console.log("Evento atualizado com sucesso:",x)}).catch(x=>{o[s.id]=!1,console.warn("Erro ao editar data do evento:",x)})}},openEventLink(s){s&&window.open(s,"_blank")},handleDelete(s){confirm("Tem certeza que deseja excluir este evento?")&&(o[s.id]=!0,b.deleteGoogleEvent(s.calendarId,s.id).then(()=>{o[s.id]=!1}).catch(e=>{o[s.id]=!1,console.warn("Erro ao excluir evento:",e)}))}},_=te({});function D(){Object.values(c.grouped.value).flat().forEach(e=>{_[e.id]?_[e.id].getHTML()!==(e.description||"")&&_[e.id].commands.setContent(e.description||"",!1):_[e.id]=new _e({content:e.description||"",extensions:[Ee],editorProps:{attributes:{class:"focus:outline-none min-h-[60px] p-2"}},onUpdate:({editor:l})=>{c.handleEdit(e,"description",l.getHTML())}})})}N(()=>c.grouped.value,()=>{ye(()=>{D()})},{immediate:!0,deep:!0});function S(s){const e=_[s.id];if(!e)return;const l=e.getHTML();c.handleEdit(s,"description",l)}function C(s,e){const l=e.target.value;l>=s.startEvent?c.updateDate(s,"endEvent",l):(e.target.value=s.endEvent,alert("A data/hora final não pode ser menor que a inicial."))}const h=c.grouped;return(s,e)=>{const l=G;return v(),w("div",Xe,[(v(!0),w(q,null,B(d(h),(i,u)=>(v(),w("div",{key:u},[t("table",null,[t("thead",null,[t("tr",null,[t("th",et,A(u||"(sem título)"),1)])]),t("tbody",null,[(v(!0),w(q,null,B(i,r=>(v(),w("tr",{key:r.id,onDblclick:a=>c.openEventLink(r.htmlLink)},[t("td",null,[r.recurringEventId?(v(),R(l,{key:0,name:"la:redo-alt",class:"print-hide icon",style:{color:"#9e9e9e"}})):M("",!0)]),t("td",at,[I(t("input",{"onUpdate:modelValue":a=>r.startEvent=a,type:"datetime-local",class:U([{updating:o[r.id]},"date-clean"]),onFocusout:a=>c.updateDate(r,"startEvent",a.target.value)},null,42,ot),[[O,r.startEvent]])]),t("td",rt,[I(t("input",{"onUpdate:modelValue":a=>r.endEvent=a,type:"datetime-local",min:r.startEvent,class:U([{updating:o[r.id]},"date-clean"]),onFocusout:a=>C(r,a)},null,42,st),[[O,r.endEvent]])]),t("td",{contenteditable:"true",class:U([{updating:o[r.id]},"print-hide tooltip"]),"data-tooltip":"Grupo",onFocusout:a=>c.handleEdit(r,"summary",a.target.innerText.trim())},A(r.summary),43,nt),t("td",{contenteditable:"true",class:U(["tooltip",{updating:o[r.id]}]),"data-tooltip":"Local",onFocusout:a=>c.handleEdit(r,"location",a.target.innerText.trim())},A(r.location||""),43,lt),t("td",{class:U({updating:o[r.id]})},[T(d(he),{editor:_[r.id],onBlur:a=>S(r)},null,8,["editor","onBlur"])],2),t("td",it,[t("button",{title:"Excluir evento",class:"btn-clean",onClick:a=>c.handleDelete(r)}," 🗑️ ",8,dt)])],40,tt))),128))])])]))),128))])}}},ct=ae(ut,[["__scopeId","data-v-21d13532"]]),pt={class:"border shadow",style:{width:"100%"}},mt={key:0,style:{padding:"1rem",background:"#fff","border-radius":"0 0 0.5rem 0.5rem"}},ft=["value"],gt={style:{display:"block","margin-top":"0.25rem","font-size":"0.85em",color:"#6b7280"}},vt={__name:"recurrence",props:{rrule:{type:String,default:""},data:{type:Object,default:()=>({})},recurrence:{type:String,default:""}},emits:["update:rrule","update:recurrence"],setup(L,{emit:b}){const g=F(!1),o=L,$=b,c=F(o.rrule||""),_=F("");N(()=>o.rrule,h=>{c.value=h||""});const D=j(()=>{var s;if(!((s=o.data)!=null&&s.date))return null;const h=new Date(o.data.date);return isNaN(h.getTime())?null:h});function S(h){c.value=h.target.value,$("update:rrule",c.value),C()}function C(){var p;_.value="";const h=((p=c.value)==null?void 0:p.toUpperCase())||"",s=/^(\d+)([DSMA])$/.exec(h);if(!o.data||!D.value){_.value="Data inválida.",$("update:recurrence","");return}if(!s){_.value="Expressão de recorrência inválida. Use [número][D/S/M/A]",$("update:recurrence","");return}const e=+s[1],i={D:"DAILY",S:"WEEKLY",M:"MONTHLY",A:"YEARLY"}[s[2]];if(!i||e<=0){_.value="Tipo ou intervalo inválido.",$("update:recurrence","");return}const u=D.value,a=["SU","MO","TU","WE","TH","FR","SA"][u.getDay()];if(i==="WEEKLY")$("update:recurrence",`RRULE:FREQ=${i};INTERVAL=${e};BYDAY=${a}`);else if(i==="MONTHLY"){let E=Math.floor((u.getDate()-1)/7)+1;const k=new Date(u);k.setDate(u.getDate()+7),k.getMonth()!==u.getMonth()&&(E=-1);const x=(E===-1?"-1":E)+a;$("update:recurrence",`RRULE:FREQ=${i};INTERVAL=${e};BYDAY=${x}`)}else if(i==="YEARLY"){const E=u.getMonth()+1,k=u.getDate();let x=Math.floor((k-1)/7)+1;const m=new Date(u);m.setDate(k+7),m.getMonth()!==u.getMonth()&&(x=-1);const z=(x===-1?"-1":x)+a;$("update:recurrence",`RRULE:FREQ=YEARLY;INTERVAL=${e};BYMONTH=${E};BYDAY=${z}`)}else $("update:recurrence",`RRULE:FREQ=${i};INTERVAL=${e}`)}return N(()=>{var h;return(h=o.data)==null?void 0:h.date},C,{immediate:!0}),(h,s)=>{const e=G;return v(),w("div",pt,[t("button",{type:"button",style:{display:"flex","align-items":"center",width:"100%",padding:"1rem","text-align":"left",color:"#374151",background:"none",border:"none",cursor:"pointer"},onClick:s[0]||(s[0]=l=>g.value=!g.value)},[T(e,{name:"la:tools"}),s[1]||(s[1]=t("span",{style:{"margin-left":"0.5rem"}},"Outras opções",-1)),T(e,{name:"la:angle-double-down",style:be([{"margin-left":"auto",transition:"transform 0.2s"},{transform:g.value?"rotate(180deg)":""}])},null,8,["style"])]),g.value?(v(),w("div",mt,[s[2]||(s[2]=t("label",{for:"rrule-input",style:{display:"block","font-size":"0.95em","font-weight":"500",color:"#374151","margin-bottom":"0.25rem"}},"Recorrência",-1)),t("input",{id:"rrule-input",value:c.value,type:"text",style:{width:"100%",border:"1px solid #d1d5db","border-radius":"0.375rem",padding:"0.5rem 0.75rem","font-size":"0.95em"},placeholder:"Ex: 2S para cada 2 semanas ou 1M para cada mês",autocomplete:"off",onInput:S},null,40,ft),t("small",gt,A(_.value)+" "+A(L.recurrence),1)])):M("",!0)])}}},yt={class:"form-group"},bt=["value"],$t={class:"form-group"},ht={class:"form-group"},_t={class:"row"},Et={class:"form-group"},wt={class:"row"},Dt={class:"form-group",style:{flex:"1 1 100%"}},kt={for:"desc",style:{display:"flex","align-items":"center",gap:"0.5rem"}},xt={class:"tooltip","data-tooltip":"!nodate para não mostrar a data e hora. "},It={class:"form-group",style:{flex:"1 1 100%"}},St={__name:"create",setup(L){var z,re;const{$toast:b}=oe(),{lista:g,agenda:o}=H(),$=ue(),c=y=>String(y).padStart(2,"0");function _(y){return(y||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}function D(y,n,f=4){if(!n)return y.slice(0,f);const V=_(n);return y.filter(Y=>n!==Y).filter(Y=>V.split(" ").every(P=>_(Y).includes(P))).slice(0,f)}function S(y){if(!y)return"";const n=new Date(y);return`${n.getFullYear()}-${c(n.getMonth()+1)}-${c(n.getDate())}T${c(n.getHours())}:${c(n.getMinutes())}`}function C(){const y=new Date,n=new Date;n.setDate(y.getDate()+70);const f=new Date(y);return f.setHours(19,0,0,0),{today:S(f),future:S(n)}}const{today:h}=C(),s=h,e=te({calendarId:"",date:((z=$.query)==null?void 0:z.date)||s,title:"",locale:((re=$.query)==null?void 0:re.locale)||"",desc:"",recurrence:""});$e(()=>{const y=o.calendars.filter(n=>o.filters.calendarIDs.includes(n.id));y.length===1&&(e.calendarId=y[0].id)});const l=g.titles,i=g.locales,u=g.desc,r=j(()=>D(l,e.title,3)),a=j(()=>D(i,e.locale,3)),p=j(()=>{if(!e.desc)return[];const y=e.desc.trim().split(/\s+/),n=y.slice(-2).join(" "),f=y.slice(-1).join(" "),V=new Set([...D(u,n),...D(u,f)]);return Array.from(V).slice(0,3)});function E(y,n){n&&(e[y]=n)}function k(y,n){n&&n.length>0&&(e[y]=n[0])}function x(){}async function m(){if(!e.calendarId||!o.calendars.some(y=>y.id===e.calendarId)){alert("Selecione um calendário válido.");return}if(e.date&&e.title&&e.locale){const y={...e};try{const n=new Date(y.date);if(isNaN(n.getTime())){alert("Data inválida.");return}const f=Intl.DateTimeFormat().resolvedOptions().timeZone,V=new Date(n.getTime()+2*60*60*1e3),Y=n.toISOString(),P=V.toISOString(),se={summary:y.title,location:y.locale,description:y.desc,start:{dateTime:Y,timeZone:f},end:{dateTime:P,timeZone:f}};y.recurrence&&(se.recurrence=[y.recurrence]);const ne=await o.createGoogleEvent(y.calendarId,se);b.success(ne.summary+" criado com sucesso: "+ne.description),e.date=s,e.locale="",e.desc="",e.rrule="",e.recurring=""}catch(n){b.error("Erro ao criar evento: "+((n==null?void 0:n.message)||n)),console.log("Erro ao criar evento: ",n)}}else alert("Por favor, preencha todos os campos obrigatórios.")}return(y,n)=>(v(),w("div",null,[t("form",{class:"form-inline",onSubmit:Q(m,["prevent"])},[t("div",yt,[n[14]||(n[14]=t("label",{for:"calendar"},"Calendário:",-1)),I(t("select",{id:"calendar","onUpdate:modelValue":n[0]||(n[0]=f=>e.calendarId=f),required:""},[(v(!0),w(q,null,B(d(o).calendars.filter(f=>d(o).filters.calendarIDs.includes(f.id)),f=>(v(),w("option",{key:f.id,value:f.id},A(f.summary),9,bt))),128))],512),[[ce,e.calendarId]])]),t("div",$t,[n[15]||(n[15]=t("label",{for:"date"},"Data:",-1)),I(t("input",{id:"date","onUpdate:modelValue":n[1]||(n[1]=f=>e.date=f),type:"datetime-local",required:""},null,512),[[O,e.date]])]),t("div",ht,[n[16]||(n[16]=t("label",{for:"title"},"Título:",-1)),t("div",_t,[I(t("input",{id:"title","onUpdate:modelValue":n[2]||(n[2]=f=>e.title=f),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[n[3]||(n[3]=W(Q(f=>k("title",r.value),["prevent"]),["enter"])),n[4]||(n[4]=W(f=>void 0,["tab"]))]},null,544),[[O,e.title]]),e.title.length>0&&r.value.length?(v(),R(J,{key:0,suggestions:r.value,onSelect:n[5]||(n[5]=f=>E("title",f))},null,8,["suggestions"])):M("",!0)])]),t("div",Et,[n[17]||(n[17]=t("label",{for:"locale"},"Local:",-1)),t("div",wt,[I(t("input",{id:"locale","onUpdate:modelValue":n[6]||(n[6]=f=>e.locale=f),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[n[7]||(n[7]=W(Q(f=>k("locale",a.value),["prevent"]),["enter"])),n[8]||(n[8]=W(f=>void 0,["tab"]))]},null,544),[[O,e.locale]]),e.locale.length>0&&a.value.length?(v(),R(J,{key:0,suggestions:a.value,onSelect:n[9]||(n[9]=f=>E("locale",f))},null,8,["suggestions"])):M("",!0)])]),t("div",Dt,[t("label",kt,[t("span",xt,[n[18]||(n[18]=ee(" Descrição: ")),T(d(G),{name:"la:info-circle",style:{color:"#2563eb",cursor:"pointer"}})])]),I(t("textarea",{id:"desc","onUpdate:modelValue":n[10]||(n[10]=f=>e.desc=f),rows:"4"},null,512),[[O,e.desc]]),e.desc.length>0&&p.value.length?(v(),R(J,{key:0,suggestions:p.value,onSelect:n[11]||(n[11]=f=>E("desc",f))},null,8,["suggestions"])):M("",!0)]),t("div",It,[n[19]||(n[19]=t("label",null,null,-1)),T(vt,{rrule:e.rrule,"onUpdate:rrule":n[12]||(n[12]=f=>e.rrule=f),recurrence:e.recurrence,"onUpdate:recurrence":n[13]||(n[13]=f=>e.recurrence=f),msg:d(g).msg,data:e},null,8,["rrule","recurrence","msg","data"])]),n[20]||(n[20]=t("div",{class:"form-group",style:{flex:"1 1 100%","text-align":"right"}},[t("label"),t("button",{type:"submit",class:"success",style:{width:"100%","max-width":"200px"}}," Adicionar ")],-1))],32)]))}},Tt={class:"print-hide"},Ot={class:"tabs-container print-hide"},At={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Mt=["aria-selected"],Ct=["aria-selected"],Ft=["aria-selected"],Ut={class:"tab-content"},Lt={id:"tab-content-filters",role:"tabpanel"},Rt={key:0,id:"tab-content-create",role:"tabpanel"},zt={id:"tab-content-git",role:"tabpanel"},qt={__name:"eventos",setup(L){const{auth:b}=H(),g=F("filters");function o($){g.value=$}return($,c)=>{const _=G,D=ke;return v(),w("div",null,[t("div",Tt,[t("div",Ot,[t("nav",At,[I(t("span",{id:"tab-create","aria-selected":g.value==="git",role:"tab",type:"button",class:U(["tab",{active:g.value==="git"}]),onClick:c[0]||(c[0]=S=>o("git"))},[T(_,{name:"la:git",class:"icon"})],10,Mt),[[K,d(b).user.token]]),I(t("span",{id:"tab-create","aria-selected":g.value==="create",role:"tab",type:"button",class:U(["tab",{active:g.value==="create"}]),onClick:c[1]||(c[1]=S=>o("create"))},[T(_,{name:"la:plus",class:"icon"})],10,Ct),[[K,d(b).user.token]]),t("span",{id:"tab-filters","aria-selected":g.value==="filters",role:"tab",type:"button",class:U(["tab",{active:g.value==="filters"}]),onClick:c[2]||(c[2]=S=>o("filters"))},[T(_,{name:"la:filter",class:"icon"})],10,Ft)])]),t("div",Ut,[I(t("div",Lt,[T(Ze)],512),[[K,g.value==="filters"]]),g.value==="create"?(v(),w("div",Rt,[T(St)])):M("",!0),I(t("div",zt,[T(D)],512),[[K,g.value==="git"]])])]),d(b).user.token?(v(),R(ct,{key:0})):M("",!0)])}}};export{qt as default};
