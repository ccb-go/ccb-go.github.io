import{_ as W,r as M,x as ie,D as z,c as E,g as A,o as v,h as x,a as t,v as O,q as ne,s as G,y as ae,p as c,b as L,C as R,E as ce,w as pe,n as F,t as T,T as fe,G as le,H as de,k as me,I as X,J as ue,F as N,j as V,K as ge,e as ee,z as te,f as j,L as ve,M as ye,N as be,i as H,l as J,A as K}from"./DedCoyFO.js";import{E as $e,a as he,S as Ee}from"./B4GR9zTN.js";const we={key:0,class:"space-y-4 max-w-md mx-auto"},De={__name:"git",setup(U,{expose:y}){const m=M(""),a=M(""),b=M(""),d=M(!1);ie(()=>{const h=localStorage.getItem("git_config");if(h)try{const o=JSON.parse(atob(h));m.value=o.token||"",a.value=o.repoOwner||"",b.value=o.repoName||""}catch(o){console.log("Erro::: ",o)}d.value=!0}),z([m,a,b],()=>{const h={token:m.value,repoOwner:a.value,repoName:b.value};localStorage.setItem("git_config",btoa(JSON.stringify(h)))},{deep:!0});const w=()=>({Authorization:`Bearer ${m.value}`,"Content-Type":"application/json; charset=UTF-8",Accept:"application/vnd.github.v3+json"}),D=async h=>{var l;const o=`https://api.github.com/repos/${a.value}/${b.value}/contents/${h}`,{data:e,error:i}=await ne(o,{method:"GET",headers:w(),pick:["content","sha"],watch:!1},"$9xe66jx9KU");if(i.value)throw new Error(`Erro ao buscar: ${((l=i.value.data)==null?void 0:l.message)||i.value.message}`);return{content:Buffer.from(e.value.content,"base64").toString("utf-8"),sha:e.value.sha}},S=async(h,o)=>{var s;console.log("Solicitacao de atualizacao:: ",h,o);const e=`https://api.github.com/repos/${a.value}/${b.value}/contents/${o}`,i=w();let u=null;try{const f=await D(o);if(f.content===h)return console.info("GIT: Conteúdo idêntico."),!1;u=f.sha}catch(f){if(!f.message.includes("404"))throw f;console.log("GIT: Arquivo será criado.")}const l={message:u?"Atualização via Nuxt":"Criação via Nuxt",content:Buffer.from(h,"utf-8").toString("base64"),...u&&{sha:u}},{error:r}=await ne(e,{method:"PUT",headers:i,body:l,watch:!1},"$aH25C_JKj4");if(r.value)throw new Error(`Erro ao enviar: ${((s=r.value.data)==null?void 0:s.message)||r.value.message}`);return console.log("GIT: Enviado com sucesso!"),!0},C=async()=>{await S(`# Atualizado em ${new Date().toISOString()}`,"README.md")};return y({getFile:D,pushFile:S}),(h,o)=>d.value?(v(),E("div",we,[x(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),type:"password",placeholder:"Token",class:"input"},null,512),[[O,m.value]]),x(t("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>a.value=e),placeholder:"Owner",class:"input"},null,512),[[O,a.value]]),x(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>b.value=e),placeholder:"Repo",class:"input"},null,512),[[O,b.value]]),t("button",{class:"btn",onClick:C},"Sync")])):A("",!0)}},ke=W(De,[["__scopeId","data-v-adc87aea"]]),_e={class:"container"},xe={key:0},Ie={class:"dropdown-content"},Se={class:"dropdown-avatar-container"},Te={class:"countdown"},Oe={key:1},Q=!1,Ae={__name:"auth",setup(U){const{auth:y}=G(),{$toast:m}=ae(),a=M(!1),b=M(!1),d=M(!1);function w(){a.value=!a.value}function D(){a.value=!1}async function S(){const e=()=>m.success("Conectando"),i=u=>m.error("Erro ao conectar: "+u);try{await m.promise(y.signIn({callback:e,errorCallback:i}),{pending:"Conectando...",success:"Janela de solicitação aberta!",error:"Erro ao conectar."})}catch(u){console.error("Erro ao fazer login:",u),i(u)}}async function C(){try{const e=()=>{m.success("Até logo!",{duration:2e3,position:"top-right"}),D()},i=u=>m.error("Erro ao desconectar: "+u);await y.signOut(e,i)}catch(e){m.error("Erro ao fazer logout: "+e)}}const h=e=>e>0?[e/3600,e%3600/60,e%60].map(i=>String(Math.floor(i)).padStart(2,"0")).join(":"):"00:00:00",o=ce({props:{src:{type:String,default:""},alt:{type:String,default:""},fallback:{type:String,default:""},hovered:Boolean,size:{type:Number,default:2.5},border:{type:String,default:"#d1d5db"}},setup(e){const i=M(!1);return()=>i.value?le("div",{class:"avatar-fallback",style:{width:`${e.size}rem`,height:`${e.size}rem`,borderRadius:"9999px",border:`2px solid ${e.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:"#e5e7eb",color:"#111827",fontSize:e.size===4?"2rem":"1.25rem",fontWeight:600,transition:"border-color 0.2s"},class:{"avatar-hovered":e.hovered}},e.fallback):le("img",{src:e.src,alt:e.alt,class:"avatar",style:{width:`${e.size}rem`,height:`${e.size}rem`,borderRadius:"9999px",border:`2px solid ${e.border}`,transition:"border-color 0.2s"},class:{"avatar-hovered":e.hovered},onError:()=>i.value=!0})}});return(e,i)=>(v(),E("div",_e,[c(y).user.token?(v(),E("div",xe,[t("div",{class:"avatar-container",onClick:w,onMouseover:i[0]||(i[0]=u=>b.value=!0),onMouseleave:i[1]||(i[1]=u=>b.value=!1)},[(v(),R(c(o),{key:c(y).user.picture,src:c(y).user.picture,alt:c(y).user.name,fallback:c(y).user.name.charAt(0).toUpperCase(),hovered:b.value,size:2.5},null,8,["src","alt","fallback","hovered"]))],32),L(fe,{name:"fade"},{default:pe(()=>[a.value?(v(),E("div",{key:0,class:F(["dropdown",{"dropdown-dark":Q}])},[t("div",Ie,[t("div",Se,[(v(),R(c(o),{key:c(y).user.picture,src:c(y).user.picture,alt:c(y).user.name,fallback:c(y).user.name.charAt(0).toUpperCase(),size:4,border:"#3b82f6"},null,8,["src","alt","fallback"]))]),t("div",{class:F(["user-name",{"user-name-dark":Q}])},T(c(y).user.name),3),t("div",{class:F(["user-email",{"user-email-dark":Q}])},T(c(y).user.email),3),t("button",{class:F(["signout-button",{"signout-button-hovered":d.value}]),onClick:C,onMouseover:i[2]||(i[2]=u=>d.value=!0),onMouseleave:i[3]||(i[3]=u=>d.value=!1)},[i[4]||(i[4]=t("span",null,"Sair",-1)),t("span",Te,T(h(c(y).user.expires_countdown)),1)],34)])],2)):A("",!0)]),_:1}),a.value?(v(),E("div",{key:0,class:"overlay",onClick:D})):A("",!0)])):(v(),E("div",Oe,[t("button",{class:"gsi-material-button",type:"button",onClick:S},i[5]||(i[5]=[t("div",{class:"gsi-material-button-state"},null,-1),t("div",{class:"gsi-material-button-content-wrapper"},[t("div",{class:"gsi-material-button-icon"}),t("span",{class:"gsi-material-button-contents"},"Entrar com Google")],-1)]))]))]))}},Ce=W(Ae,[["__scopeId","data-v-fd966e2c"]]),Me={class:"form-inline"},Fe={class:"form-group"},Ue={class:"row"},Le={class:"form-group"},Re={class:"row"},ze={class:"form-group"},Ne={class:"row"},Ve=["value"],Ye={class:"form-group"},qe={class:"flex gap-xs"},je={class:"form-group"},Ge={class:"flex gap-xs"},Be={class:"form-group",style:{"align-items":"flex-start"}},He=["id","value"],Ke=["for"],We={class:"form-group",style:{"text-align":"right"}},Pe=["disabled"],Je={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Qe={__name:"filters-agenda",setup(U){const y=de(),m=me(),{agenda:a,auth:b}=G(),{$toast:d}=ae(),w=M(!1),D={formatISOToInput(r){if(!r)return"";const s=new Date(r);return r.length>10?s.toISOString().slice(0,16):s.toISOString().slice(0,10)},getDefaultDates(){const r=new Date,s=new Date;return s.setDate(r.getDate()+70),{today:this.formatISOToInput(r),future:this.formatISOToInput(s)}},getFriendlyErrorMessage(r){var f,k,_,p;const s=((k=(f=r==null?void 0:r.result)==null?void 0:f.error)==null?void 0:k.message)||(r==null?void 0:r.message)||(r==null?void 0:r.toString())||"";return s.includes("Request is missing required authentication credential")?"Sua sessão expirou. Por favor, faça login novamente para acessar os eventos.":`Erro (${((p=(_=r==null?void 0:r.result)==null?void 0:_.error)==null?void 0:p.code)||""}) ao carregar eventos: ${s}`},sleep(r){return new Promise(s=>setTimeout(s,r))}},{today:S,future:C}=D.getDefaultDates();(()=>{const r=y.query||{};if(r.calendar){const s=Array.isArray(r.calendar)?r.calendar:r.calendar.split(",").filter(Boolean);a.filters.calendarIDs=s}else a.filters.calendarIDs=[];a.filters.title=r.title||"",a.filters.locale=r.locale||"",a.filters.search=r.search||"",a.filters.date=r.date||"",a.filters.start=r.start||S,a.filters.end=r.end||C})();const o=X(()=>{const r=Object.fromEntries(Object.entries(a.filters).filter(([s,f])=>s==="calendarIDs"?Array.isArray(f)&&f.length>0:f!==""&&f!==null&&f!==void 0).map(([s,f])=>s==="calendarIDs"&&Array.isArray(f)?["calendar",f.join(",")]:[s,f]));m.replace({query:{...r}})},300);function e(r){a.filters[r]="",r==="date"&&(a.filters.start=D.formatISOToInput(S),a.filters.end=D.formatISOToInput(C)),r==="calendarIDs"&&(a.filters.calendarIDs=[]),o()}async function i(){var r,s,f,k,_,p;try{if(window&&!((s=(r=window==null?void 0:window.gapi)==null?void 0:r.client)!=null&&s.calendar)){d.error("Google Calendar API não está disponível. Faça login ou aguarde o carregamento.");return}await D.sleep(200),await d.promise(a.fetchGoogleCalendars(),{pending:"Carregando eventos...",success:"Eventos carregados com sucesso!",error:{render({data:I}){return D.getFriendlyErrorMessage(I)}}})}catch(I){d.error(D.getFriendlyErrorMessage(I)),console.error(`Erro (${(k=(f=I.result)==null?void 0:f.error)==null?void 0:k.code}) ao carregar eventos: ${(p=(_=I.result)==null?void 0:_.error)==null?void 0:p.message}`,I)}finally{w.value=!1}}async function u(){await a.fetchGoogleEvents()}const l=X(async()=>{try{w.value=!0,await a.awaitGapi(),await i(),await u()}catch{d.error("Google Calendar API não foi carregada. Tente recarregar a página ou aguarde.")}finally{w.value=!1}},400);return z(()=>b.user.token,async r=>{r&&l()},{immediate:!0}),ie(()=>{l()}),z(()=>({...a.filters}),()=>{o()},{deep:!0}),(r,s)=>{var f,k,_;return v(),E("div",null,[L(Ce,{style:{"margin-bottom":"8px"}}),t("div",Me,[t("div",null,[t("div",Fe,[s[11]||(s[11]=t("label",{for:"search",class:"text-sm font-medium text-gray-700 mb-1"},"Pesquisar",-1)),t("div",Ue,[x(t("input",{id:"search","onUpdate:modelValue":s[0]||(s[0]=p=>c(a).filters.search=p),type:"text",placeholder:"Buscar eventos..."},null,512),[[O,c(a).filters.search]]),c(a).filters.search?(v(),E("button",{key:0,"aria-label":"Limpar pesquisa",type:"button",onClick:s[1]||(s[1]=p=>e("search"))}," × ")):A("",!0)])]),t("div",Le,[s[12]||(s[12]=t("label",{for:"title",class:"text-sm font-medium text-gray-700 mb-1"},"Título",-1)),t("div",Re,[x(t("input",{id:"title","onUpdate:modelValue":s[2]||(s[2]=p=>c(a).filters.title=p),type:"text",placeholder:"Filtrar por título..."},null,512),[[O,c(a).filters.title]]),c(a).filters.title?(v(),E("button",{key:0,"aria-label":"Limpar título",type:"button",onClick:s[3]||(s[3]=p=>e("title"))}," × ")):A("",!0)])]),t("div",ze,[s[14]||(s[14]=t("label",{for:"locale",class:"text-sm font-medium text-gray-700 mb-1"},"Local",-1)),t("div",Ne,[x(t("select",{id:"locale","onUpdate:modelValue":s[4]||(s[4]=p=>c(a).filters.locale=p)},[s[13]||(s[13]=t("option",{value:""},"Todos os locais",-1)),(v(!0),E(N,null,V(c(a).eventsLocales,p=>(v(),E("option",{key:p,value:p},T(p),9,Ve))),128))],512),[[ue,c(a).filters.locale]]),c(a).filters.locale?(v(),E("button",{key:0,"aria-label":"Limpar local",type:"button",onClick:s[5]||(s[5]=p=>e("locale"))}," × ")):A("",!0)])]),t("div",Ye,[s[15]||(s[15]=t("label",{for:"date",class:"text-sm font-medium text-gray-700 mb-1"},"Data",-1)),t("div",qe,[x(t("input",{id:"date","onUpdate:modelValue":s[6]||(s[6]=p=>c(a).filters.date=p),type:"date"},null,512),[[O,c(a).filters.date]]),c(a).filters.date?(v(),E("button",{key:0,"aria-label":"Limpar data",type:"button",onClick:s[7]||(s[7]=p=>e("date"))}," × ")):A("",!0)])]),t("div",je,[s[16]||(s[16]=t("label",null,"Intervalo de Datas",-1)),t("div",Ge,[x(t("input",{id:"datepicker-range-start","onUpdate:modelValue":s[8]||(s[8]=p=>c(a).filters.start=p),type:"date"},null,512),[[O,c(a).filters.start]]),x(t("input",{id:"datepicker-range-end","onUpdate:modelValue":s[9]||(s[9]=p=>c(a).filters.end=p),type:"date"},null,512),[[O,c(a).filters.end]])])])]),t("div",null,[t("div",Be,[s[17]||(s[17]=t("label",null,"Calendários",-1)),t("div",null,[(v(!0),E(N,null,V(c(a).calendars,p=>(v(),E("div",{key:p.id,style:{"margin-bottom":"2px"}},[x(t("input",{id:"calendar-"+p.id,"onUpdate:modelValue":s[10]||(s[10]=I=>c(a).filters.calendarIDs=I),type:"checkbox",value:p.id,style:{margin:"5px 5px 0 0"}},null,8,He),[[ge,c(a).filters.calendarIDs]]),t("label",{for:"calendar-"+p.id,style:{"margin-bottom":"0"}},T(p.summary),9,Ke)]))),128))])]),t("div",We,[s[18]||(s[18]=t("label",null,null,-1)),t("button",{class:"success",disabled:c(w)||c(a).loading,onClick:u},T(c(w)||c(a).loading?"Atualizando...":"Aplicar"),9,Pe)])])]),t("div",Je,[t("span",null,[s[19]||(s[19]=t("i",{class:"la la-calendar-check"},null,-1)),ee(" "+T((k=(f=c(a))==null?void 0:f.calendars)==null?void 0:k.length),1)]),t("span",null,[s[20]||(s[20]=t("i",{class:"la la-tasks"},null,-1)),ee(" "+T((_=c(a).eventsFiltered)==null?void 0:_.length),1)])])])}}},Ze={style:{"max-width":"297mm",margin:"0 auto"}},Xe={colspan:"8"},et=["onDblclick"],tt={key:0,class:"la la-redo-alt print-hide",style:{color:"#9e9e9e"}},at={class:"tooltip","data-tooltip":"Data fim"},ot=["onUpdate:modelValue","onFocusout"],st={class:"tooltip print-hide","data-tooltip":"Data fim"},rt=["onUpdate:modelValue","min","onFocusout"],nt=["onFocusout"],lt=["onFocusout"],it={class:"print-hide"},dt=["onClick"],ut={__name:"edit",setup(U){const{agenda:y,lista:m}=G(),a=te({}),b={formatISOToInput(o){if(!o)return"";const e=new Date(o),i=u=>u.toString().padStart(2,"0");return o.length>10?`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())}T${i(e.getHours())}:${i(e.getMinutes())}`:`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())}`}},d={grouped:j(()=>{const o=m.titles||[],e=(y.eventsFiltered||[]).reduce((u,l)=>{var s,f,k,_;const r=l.summary||l.title||"";return u[r]||(u[r]=[]),u[r].push({...l,startEvent:b.formatISOToInput(((s=l.start)==null?void 0:s.dateTime)||((f=l.start)==null?void 0:f.date)),endEvent:b.formatISOToInput(((k=l.end)==null?void 0:k.dateTime)||((_=l.end)==null?void 0:_.date))}),u},{}),i={};return o.forEach(u=>{e[u]&&(i[u]=e[u])}),Object.keys(e).forEach(u=>{i[u]||(i[u]=e[u])}),i}),_debouncers:{},handleEdit(o,e,i){if(i!==(o[e]||"")){const u=`${o.id}_${e}`;a[o.id]=!0,this._debouncers[u]||(this._debouncers[u]=X((l,r,s)=>{const f={summary:r==="summary"?s:l.summary,location:r==="location"?s:l.location,description:r==="description"?s:l.description,start:l.start,end:l.end},k=l.calendarId;y.updateGoogleEvent(k,l.id,f).then(()=>{a[l.id]=!1}).catch(_=>{a[l.id]=!1,console.warn("Erro ao editar evento:",_)})},3e3)),this._debouncers[u](o,e,i)}},updateDate(o,e,i){var l,r;if(b.formatISOToInput(((l=o.start)==null?void 0:l.dateTime)||((r=o.start)==null?void 0:r.date))!==i){a[o.id]=!0;let s=o.start,f=o.end;const k=Intl.DateTimeFormat().resolvedOptions().timeZone;if(e==="startEvent"){const p=new Date(i),I=new Date(p.getTime()+2*60*60*1e3);I.setMinutes(0,0,0),s={...s,dateTime:p.toISOString(),timeZone:k},f={...f,dateTime:I.toISOString(),timeZone:k}}else if(e==="endEvent"){const p=new Date(i);f={...f,dateTime:p.toISOString(),timeZone:k}}const _={summary:o.summary,location:o.location,description:o.description,start:s,end:f};y.updateGoogleEvent(o.calendarId,o.id,_).then(p=>{a[o.id]=!1,console.log("Evento atualizado com sucesso:",p)}).catch(p=>{a[o.id]=!1,console.warn("Erro ao editar data do evento:",p)})}},openEventLink(o){o&&window.open(o,"_blank")},handleDelete(o){confirm("Tem certeza que deseja excluir este evento?")&&(a[o.id]=!0,y.deleteGoogleEvent(o.calendarId,o.id).then(()=>{a[o.id]=!1}).catch(e=>{a[o.id]=!1,console.warn("Erro ao excluir evento:",e)}))}},w=te({});function D(){Object.values(d.grouped.value).flat().forEach(e=>{w[e.id]?w[e.id].getHTML()!==(e.description||"")&&w[e.id].commands.setContent(e.description||"",!1):w[e.id]=new he({content:e.description||"",extensions:[Ee],editorProps:{attributes:{class:"focus:outline-none min-h-[60px] p-2"}},onUpdate:({editor:i})=>{d.handleEdit(e,"description",i.getHTML())}})})}z(()=>d.grouped.value,()=>{ve(()=>{D()})},{immediate:!0,deep:!0});function S(o){const e=w[o.id];if(!e)return;const i=e.getHTML();d.handleEdit(o,"description",i)}function C(o,e){const i=e.target.value;i>=o.startEvent?d.updateDate(o,"endEvent",i):(e.target.value=o.endEvent,alert("A data/hora final não pode ser menor que a inicial."))}const h=d.grouped;return(o,e)=>(v(),E("div",Ze,[(v(!0),E(N,null,V(c(h),(i,u)=>(v(),E("div",{key:u},[t("table",null,[t("thead",null,[t("tr",null,[t("th",Xe,T(u||"(sem título)"),1)])]),t("tbody",null,[(v(!0),E(N,null,V(i,l=>(v(),E("tr",{key:l.id,onDblclick:r=>d.openEventLink(l.htmlLink)},[t("td",null,[l.recurringEventId?(v(),E("i",tt)):A("",!0)]),t("td",at,[x(t("input",{"onUpdate:modelValue":r=>l.startEvent=r,type:"datetime-local",class:F([{updating:a[l.id]},"date-clean"]),onFocusout:r=>d.updateDate(l,"startEvent",r.target.value)},null,42,ot),[[O,l.startEvent]])]),t("td",st,[x(t("input",{"onUpdate:modelValue":r=>l.endEvent=r,type:"datetime-local",min:l.startEvent,class:F([{updating:a[l.id]},"date-clean"]),onFocusout:r=>C(l,r)},null,42,rt),[[O,l.endEvent]])]),t("td",{contenteditable:"true",class:F([{updating:a[l.id]},"print-hide tooltip"]),"data-tooltip":"Grupo",onFocusout:r=>d.handleEdit(l,"summary",r.target.innerText.trim())},T(l.summary),43,nt),t("td",{contenteditable:"true",class:F(["tooltip",{updating:a[l.id]}]),"data-tooltip":"Local",onFocusout:r=>d.handleEdit(l,"location",r.target.innerText.trim())},T(l.location||""),43,lt),t("td",{class:F({updating:a[l.id]})},[L(c($e),{editor:w[l.id],onBlur:r=>S(l)},null,8,["editor","onBlur"])],2),t("td",it,[t("button",{title:"Excluir evento",class:"btn-clean",onClick:r=>d.handleDelete(l)}," 🗑️ ",8,dt)])],40,et))),128))])])]))),128))]))}},ct=W(ut,[["__scopeId","data-v-9006c6dd"]]),pt={class:"suggestion-container"},ft=["onClick"],mt={__name:"suggestion",props:{suggestions:{type:Array,required:!0}},emits:["select"],setup(U,{emit:y}){const m=y,a=d=>typeof d=="string"?d:JSON.stringify(d),b=d=>{m("select",d)};return(d,w)=>(v(),E("ul",pt,[(v(!0),E(N,null,V(U.suggestions,D=>(v(),E("li",{key:a(D),class:"suggestion-item",onClick:S=>b(D)},T(D),9,ft))),128))]))}},Z=W(mt,[["__scopeId","data-v-b2c7e18e"]]),gt={class:"border shadow",style:{width:"100%"}},vt={key:0,style:{padding:"1rem",background:"#fff","border-radius":"0 0 0.5rem 0.5rem"}},yt=["value"],bt={style:{display:"block","margin-top":"0.25rem","font-size":"0.85em",color:"#6b7280"}},$t={__name:"recurrence",props:{rrule:{type:String,default:""},data:{type:Object,default:()=>({})},recurrence:{type:String,default:""}},emits:["update:rrule","update:recurrence"],setup(U,{emit:y}){const m=M(!1),a=U,b=y,d=M(a.rrule||""),w=M("");z(()=>a.rrule,h=>{d.value=h||""});const D=j(()=>{var o;if(!((o=a.data)!=null&&o.date))return null;const h=new Date(a.data.date);return isNaN(h.getTime())?null:h});function S(h){d.value=h.target.value,b("update:rrule",d.value),C()}function C(){var f;w.value="";const h=((f=d.value)==null?void 0:f.toUpperCase())||"",o=/^(\d+)([DSMA])$/.exec(h);if(!a.data||!D.value){w.value="Data inválida.",b("update:recurrence","");return}if(!o){w.value="Expressão de recorrência inválida. Use [número][D/S/M/A]",b("update:recurrence","");return}const e=+o[1],u={D:"DAILY",S:"WEEKLY",M:"MONTHLY",A:"YEARLY"}[o[2]];if(!u||e<=0){w.value="Tipo ou intervalo inválido.",b("update:recurrence","");return}const l=D.value,s=["SU","MO","TU","WE","TH","FR","SA"][l.getDay()];if(u==="WEEKLY")b("update:recurrence",`RRULE:FREQ=${u};INTERVAL=${e};BYDAY=${s}`);else if(u==="MONTHLY"){let k=Math.floor((l.getDate()-1)/7)+1;const _=new Date(l);_.setDate(l.getDate()+7),_.getMonth()!==l.getMonth()&&(k=-1);const p=(k===-1?"-1":k)+s;b("update:recurrence",`RRULE:FREQ=${u};INTERVAL=${e};BYDAY=${p}`)}else if(u==="YEARLY"){const k=l.getMonth()+1,_=l.getDate();let p=Math.floor((_-1)/7)+1;const I=new Date(l);I.setDate(_+7),I.getMonth()!==l.getMonth()&&(p=-1);const B=(p===-1?"-1":p)+s;b("update:recurrence",`RRULE:FREQ=YEARLY;INTERVAL=${e};BYMONTH=${k};BYDAY=${B}`)}else b("update:recurrence",`RRULE:FREQ=${u};INTERVAL=${e}`)}return z(()=>{var h;return(h=a.data)==null?void 0:h.date},C,{immediate:!0}),(h,o)=>(v(),E("div",gt,[t("button",{type:"button",style:{display:"flex","align-items":"center",width:"100%",padding:"1rem","text-align":"left",color:"#374151",background:"none",border:"none",cursor:"pointer"},onClick:o[0]||(o[0]=e=>m.value=!m.value)},[o[1]||(o[1]=t("i",{class:"la la-tools"},null,-1)),o[2]||(o[2]=t("span",{style:{"margin-left":"0.5rem"}},"Outras opções",-1)),t("i",{class:"la la-angle-double-down",style:ye([{"margin-left":"auto",transition:"transform 0.2s"},{transform:m.value?"rotate(180deg)":""}])},null,4)]),m.value?(v(),E("div",vt,[o[3]||(o[3]=t("label",{for:"rrule-input",style:{display:"block","font-size":"0.95em","font-weight":"500",color:"#374151","margin-bottom":"0.25rem"}},"Recorrência",-1)),t("input",{id:"rrule-input",value:d.value,type:"text",style:{width:"100%",border:"1px solid #d1d5db","border-radius":"0.375rem",padding:"0.5rem 0.75rem","font-size":"0.95em"},placeholder:"Ex: 2S para cada 2 semanas ou 1M para cada mês",autocomplete:"off",onInput:S},null,40,yt),t("small",bt,T(w.value)+" "+T(U.recurrence),1)])):A("",!0)]))}},ht={class:"form-group"},Et=["value"],wt={class:"form-group"},Dt={class:"form-group"},kt={class:"row"},_t={class:"form-group"},xt={class:"row"},It={class:"form-group",style:{flex:"1 1 100%"}},St={class:"form-group",style:{flex:"1 1 100%"}},Tt={__name:"create",setup(U){var B,oe;const{$toast:y}=ae(),{lista:m,agenda:a}=G(),b=de(),d=$=>String($).padStart(2,"0");function w($){return($||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}function D($,n,g=4){if(!n)return $.slice(0,g);const Y=w(n);return $.filter(q=>n!==q).filter(q=>Y.split(" ").every(P=>w(q).includes(P))).slice(0,g)}function S($){if(!$)return"";const n=new Date($);return`${n.getFullYear()}-${d(n.getMonth()+1)}-${d(n.getDate())}T${d(n.getHours())}:${d(n.getMinutes())}`}function C(){const $=new Date,n=new Date;n.setDate($.getDate()+70);const g=new Date($);return g.setHours(19,0,0,0),{today:S(g),future:S(n)}}const{today:h}=C(),o=h,e=te({calendarId:"",date:((B=b.query)==null?void 0:B.date)||o,title:"",locale:((oe=b.query)==null?void 0:oe.locale)||"",desc:"",recurrence:""});be(()=>{const $=a.calendars.filter(n=>a.filters.calendarIDs.includes(n.id));$.length===1&&(e.calendarId=$[0].id)});const i=m.titles,u=m.locales,l=m.desc,r=j(()=>D(i,e.title,3)),s=j(()=>D(u,e.locale,3)),f=j(()=>{if(!e.desc)return[];const $=e.desc.trim().split(/\s+/),n=$.slice(-2).join(" "),g=$.slice(-1).join(" "),Y=new Set([...D(l,n),...D(l,g)]);return Array.from(Y).slice(0,3)});function k($,n){n&&(e[$]=n)}function _($,n){n&&n.length>0&&(e[$]=n[0])}function p(){}async function I(){if(!e.calendarId||!a.calendars.some($=>$.id===e.calendarId)){alert("Selecione um calendário válido.");return}if(e.date&&e.title&&e.locale){const $={...e};try{const n=new Date($.date);if(isNaN(n.getTime())){alert("Data inválida.");return}const g=Intl.DateTimeFormat().resolvedOptions().timeZone,Y=new Date(n.getTime()+2*60*60*1e3),q=n.toISOString(),P=Y.toISOString(),se={summary:$.title,location:$.locale,description:$.desc,start:{dateTime:q,timeZone:g},end:{dateTime:P,timeZone:g}};$.recurrence&&(se.recurrence=[$.recurrence]);const re=await a.createGoogleEvent($.calendarId,se);y.success(re.summary+" criado com sucesso: "+re.description),e.date=o,e.locale="",e.desc="",e.rrule="",e.recurring=""}catch(n){y.error("Erro ao criar evento: "+((n==null?void 0:n.message)||n)),console.log("Erro ao criar evento: ",n)}}else alert("Por favor, preencha todos os campos obrigatórios.")}return($,n)=>(v(),E("div",null,[t("form",{class:"form-inline",onSubmit:J(I,["prevent"])},[t("div",ht,[n[14]||(n[14]=t("label",{for:"calendar"},"Calendário:",-1)),x(t("select",{id:"calendar","onUpdate:modelValue":n[0]||(n[0]=g=>e.calendarId=g),required:""},[(v(!0),E(N,null,V(c(a).calendars.filter(g=>c(a).filters.calendarIDs.includes(g.id)),g=>(v(),E("option",{key:g.id,value:g.id},T(g.summary),9,Et))),128))],512),[[ue,e.calendarId]])]),t("div",wt,[n[15]||(n[15]=t("label",{for:"date"},"Data:",-1)),x(t("input",{id:"date","onUpdate:modelValue":n[1]||(n[1]=g=>e.date=g),type:"datetime-local",required:""},null,512),[[O,e.date]])]),t("div",Dt,[n[16]||(n[16]=t("label",{for:"title"},"Título:",-1)),t("div",kt,[x(t("input",{id:"title","onUpdate:modelValue":n[2]||(n[2]=g=>e.title=g),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[n[3]||(n[3]=H(J(g=>_("title",r.value),["prevent"]),["enter"])),n[4]||(n[4]=H(g=>void 0,["tab"]))]},null,544),[[O,e.title]]),e.title.length>0&&r.value.length?(v(),R(Z,{key:0,suggestions:r.value,onSelect:n[5]||(n[5]=g=>k("title",g))},null,8,["suggestions"])):A("",!0)])]),t("div",_t,[n[17]||(n[17]=t("label",{for:"locale"},"Local:",-1)),t("div",xt,[x(t("input",{id:"locale","onUpdate:modelValue":n[6]||(n[6]=g=>e.locale=g),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[n[7]||(n[7]=H(J(g=>_("locale",s.value),["prevent"]),["enter"])),n[8]||(n[8]=H(g=>void 0,["tab"]))]},null,544),[[O,e.locale]]),e.locale.length>0&&s.value.length?(v(),R(Z,{key:0,suggestions:s.value,onSelect:n[9]||(n[9]=g=>k("locale",g))},null,8,["suggestions"])):A("",!0)])]),t("div",It,[n[18]||(n[18]=t("label",{for:"desc",style:{display:"flex","align-items":"center",gap:"0.5rem"}},[t("span",{class:"tooltip","data-tooltip":"!nodate para não mostrar a data e hora. "},[ee(" Descrição: "),t("i",{class:"la la-info-circle",style:{color:"#2563eb",cursor:"pointer"}})])],-1)),x(t("textarea",{id:"desc","onUpdate:modelValue":n[10]||(n[10]=g=>e.desc=g),rows:"4"},null,512),[[O,e.desc]]),e.desc.length>0&&f.value.length?(v(),R(Z,{key:0,suggestions:f.value,onSelect:n[11]||(n[11]=g=>k("desc",g))},null,8,["suggestions"])):A("",!0)]),t("div",St,[n[19]||(n[19]=t("label",null,null,-1)),L($t,{rrule:e.rrule,"onUpdate:rrule":n[12]||(n[12]=g=>e.rrule=g),recurrence:e.recurrence,"onUpdate:recurrence":n[13]||(n[13]=g=>e.recurrence=g),msg:c(m).msg,data:e},null,8,["rrule","recurrence","msg","data"])]),n[20]||(n[20]=t("div",{class:"form-group",style:{flex:"1 1 100%","text-align":"right"}},[t("label"),t("button",{type:"submit",class:"success",style:{width:"100%","max-width":"200px"}}," Adicionar ")],-1))],32)]))}},Ot={class:"print-hide"},At={class:"tabs-container print-hide"},Ct={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Mt=["aria-selected"],Ft=["aria-selected"],Ut=["aria-selected"],Lt={class:"tab-content"},Rt={id:"tab-content-filters",role:"tabpanel"},zt={key:0,id:"tab-content-create",role:"tabpanel"},Nt={id:"tab-content-git",role:"tabpanel"},qt={__name:"eventos",setup(U){const{auth:y}=G(),m=M("filters");function a(b){m.value=b}return(b,d)=>{const w=ke;return v(),E("div",null,[t("div",Ot,[t("div",At,[t("nav",Ct,[x(t("span",{id:"tab-create","aria-selected":m.value==="git",role:"tab",type:"button",class:F(["tab",{active:m.value==="git"}]),onClick:d[0]||(d[0]=D=>a("git"))},d[3]||(d[3]=[t("i",{class:"la la-git"},null,-1)]),10,Mt),[[K,c(y).user.token]]),x(t("span",{id:"tab-create","aria-selected":m.value==="create",role:"tab",type:"button",class:F(["tab",{active:m.value==="create"}]),onClick:d[1]||(d[1]=D=>a("create"))},d[4]||(d[4]=[t("i",{class:"la la-plus"},null,-1)]),10,Ft),[[K,c(y).user.token]]),t("span",{id:"tab-filters","aria-selected":m.value==="filters",role:"tab",type:"button",class:F(["tab",{active:m.value==="filters"}]),onClick:d[2]||(d[2]=D=>a("filters"))},d[5]||(d[5]=[t("i",{class:"la la-filter icon"},null,-1)]),10,Ut)])]),t("div",Lt,[x(t("div",Rt,[L(Qe)],512),[[K,m.value==="filters"]]),m.value==="create"?(v(),E("div",zt,[L(Tt)])):A("",!0),x(t("div",Nt,[L(w)],512),[[K,m.value==="git"]])])]),c(y).user.token?(v(),R(ct,{key:0})):A("",!0)])}}};export{qt as default};
