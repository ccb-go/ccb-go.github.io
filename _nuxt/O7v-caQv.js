import{r as f,z as B,_ as M,f as D,c as z,h as F,A as G,p as A,a as j,g as q,F as V,j as R,B as J,o as T,C as K}from"./CTHaxYpG.js";const Y="865568496873-o4enb1hhvpmj2unq7v9n6dcg94h5itp6.apps.googleusercontent.com",Z="",H="https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest",Q="https://www.googleapis.com/auth/calendar";let x;function W(e){typeof window<"u"&&window.localStorage&&window.localStorage.setItem("googleAuthToken",JSON.stringify(e))}function N(){if(typeof window<"u"&&window.localStorage){const e=window.localStorage.getItem("googleAuthToken");return e?JSON.parse(e):null}return null}function X(){typeof window<"u"&&window.localStorage&&window.localStorage.removeItem("googleAuthToken")}async function ee(e){try{const t=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e}`}});return t.ok?await t.json():null}catch{return null}}async function P(){let e=0;for(;(typeof window>"u"||!window.gapi||!window.google)&&e<20;)await new Promise(o=>setTimeout(o,100)),e++;if(typeof window>"u"||!window.gapi||!window.google)throw new Error("Google API não carregada. Verifique se o script do Google API foi incluído.");await new Promise(o=>{window.gapi.load("client",o)}),await window.gapi.client.init({apiKey:Z,discoveryDocs:[H]}),x=window.google.accounts.oauth2.initTokenClient({client_id:Y,scope:Q,callback:""});const t=N();t&&t.access_token&&window.gapi.client.setToken(t)}function ne(){var t,o,i;const e=(i=(o=(t=window.gapi)==null?void 0:t.client)==null?void 0:o.getToken)==null?void 0:i.call(o);return!!(e!=null&&e.access_token)}async function te(e,t){x||await P(),x.callback=async o=>{if(o.error){t&&t(o);return}const i=await ee(o.access_token);console.log("User info tokennnn::::",i);const l={...o,user:(i==null?void 0:i.name)||"",email:(i==null?void 0:i.email)||"",expires_in:o.expires_in,expires_at:Date.now()+(o.expires_in?o.expires_in*1e3:0),rawUserInfo:i||{}};W(l),e&&e(l)},x.requestAccessToken({prompt:"consent"})}function oe(){var t,o,i;const e=(i=(o=(t=window.gapi)==null?void 0:t.client)==null?void 0:o.getToken)==null?void 0:i.call(o);e&&(window.google.accounts.oauth2.revoke(e.access_token),window.gapi.client.setToken(""),X())}function ae(){const e=N();return(e==null?void 0:e.user)||(e==null?void 0:e.email)||""}function ie(){const e=N();return(e==null?void 0:e.email)||""}async function se(){return(await window.gapi.client.calendar.calendarList.list()).result.items||[]}async function re(e,t={}){var v;const o=new Date().toISOString(),i=[];let l;do{const m={calendarId:e,timeMin:t.timeMin||o,showDeleted:!1,singleEvents:!0,maxResults:t.maxResults||100,orderBy:"startTime",...l&&{pageToken:l},...t.timeMax&&{timeMax:t.timeMax}},{result:c}=await window.gapi.client.calendar.events.list(m);(v=c==null?void 0:c.items)!=null&&v.length&&i.push(...c.items),l=c.nextPageToken}while(l);return i}async function ce(e,t){return window.gapi.client.calendar.events.insert({calendarId:e,resource:t})}async function le(e,t,o){return window.gapi.client.calendar.events.update({calendarId:e,eventId:t,resource:o})}async function de(e,t){return window.gapi.client.calendar.events.delete({calendarId:e,eventId:t})}const g={init:P,isSignedIn:ne,signIn:te,signOut:oe,listCalendars:se,listEvents:re,createEvent:ce,updateEvent:le,deleteEvent:de,getUserName:ae,getUserEmail:ie};function ue(){const e=f(!1),t=f(!1),o=f(""),i=f("");return{isSignedIn:e,isLoadingAuth:t,error:o,userName:i,initializeAuth:async()=>{try{await g.init(),e.value=g.isSignedIn(),i.value=g.getUserName?g.getUserName():"",window.google&&window.google.accounts&&window.google.accounts.id&&window.google.accounts.id.prompt(void 0,{auto_select:!0})}catch(c){o.value=`Erro ao inicializar Google API: ${c.message||c}`}},handleAuthClick:async()=>{t.value=!0,g.signIn(async()=>{t.value=!1,e.value=!0,i.value=g.getUserName?g.getUserName():""},()=>{t.value=!1,o.value="Erro de autorização: verifique o CLIENT_ID"})},handleSignoutClick:()=>{g.signOut(),e.value=!1,i.value=""},googleCalendarService:g}}function ge(){const{isSignedIn:e,isLoadingAuth:t,error:o,userName:i,initializeAuth:l,handleAuthClick:v,handleSignoutClick:m,googleCalendarService:c}=ue(),S=f(!1),y=f(""),u=B([]),h=async(a={})=>{try{await l(),e.value&&await _(a)}catch(r){y.value=`Erro ao inicializar Google API: ${r.message||r}`}},_=async(a={})=>{S.value=!0,y.value="",u.splice(0);try{const r=await c.listCalendars();console.log("Calendários retornados:",r);let s=r;a.calendarIds&&(s=r.filter(n=>a.calendarIds.includes(n.id)||a.calendarIds.includes(n.summary)));for(const n of s)u.push({id:n.id,summary:n.summary,events:[],isLoadingEvents:!0,eventsError:"",isDeleting:!1,timeZone:n.timeZone,backgroundColor:n.backgroundColor,foregroundColor:n.foregroundColor});await Promise.all(u.map(async n=>{await p(n,a),console.log(`Eventos do calendário ${n.summary}:`,n.events)}))}catch(r){y.value=`Erro ao buscar calendários: ${r.message||r}`}finally{S.value=!1}},p=async(a,r={})=>{try{a.events=await c.listEvents(a.id,r),a.isLoadingEvents=!1}catch(s){a.eventsError=`Erro ao buscar eventos: ${s.message||s}`,a.isLoadingEvents=!1}},L=async(a,r)=>{let s,n;typeof r>"u"&&a&&a.calendarId?(n=a,s=n.calendarId):(s=a,n=r);try{const d=O(n);n.location&&(d.location=n.location);const k=await c.updateEvent(s,n.id,d),w=u.find(E=>E.id===s);if(w&&k){const E=w.events.findIndex(I=>I.id===n.id);E!==-1&&(w.events[E]={...w.events[E],...k})}console.info("Evento atualizado",n,k)}catch(d){console.warn("Erro ao atualizar evento:",d)}},C=async(a,r)=>{try{const s=await c.createEvent(a,O(r)),n=u.find(d=>d.id===a);n&&s&&n.events.push({...s}),console.info("Evento criado")}catch(s){console.warn(`Erro ao criar evento: ${s.message||s}`)}},U=async(a,r)=>{const s=u.find(n=>n.id===a);if(s){s.isDeleting=!0;try{await c.deleteEvent(a,r);const n=s.events.findIndex(d=>d.id===r);n!==-1&&s.events.splice(n,1),console.info("Evento apagado")}catch(n){console.warn(`Erro ao apagar evento: ${n.message||n}`)}finally{s.isDeleting=!1}}},O=a=>{const r=a.summary||a.title||"",s=a.description||"",n=d=>{if(!d)return"";const k=new Date(d),w=-k.getTimezoneOffset(),E=w>=0?"+":"-",I=b=>String(Math.floor(Math.abs(b))).padStart(2,"0"),$=E+I(w/60)+":"+I(w%60);return k.toISOString().slice(0,19)+$};return{summary:r,description:s,start:{dateTime:n(a.startEvent||a.start)},end:{dateTime:n(a.endEvent||a.end)}}};return{isSignedIn:e,isLoading:S,isLoadingAuth:t,error:y,authError:o,calendars:u,handleAuthClick:v,handleSignoutClick:m,editEvent:L,createEvent:C,deleteEvent:U,initialize:h,userName:i}}const we={class:"container"},fe={class:"content"},ve={key:0,class:"no-data"},me={__name:"agenda",setup(e){const{isLoading:t,error:o,editEvent:i,createEvent:l,deleteEvent:v}=ge(),m=f([]),c=f({}),S=D(()=>m.value.reduce((h,_)=>{const p=_.summary||_.title||"";return h[p]||(h[p]=[]),h[p].push(_),h},{})),y=D(()=>c.value.start),u=D(()=>c.value.end);return(h,_)=>{const p=J("ListaAgendaEdit");return T(),z("div",we,[F(j("div",fe,[m.value.length===0?(T(),z("div",ve," Nenhum evento encontrado. ")):q("",!0),(T(!0),z(V,null,R(S.value,(L,C)=>(T(),K(p,{key:C,title:C,eventos:L,start:y.value,end:u.value,onEditEvent:A(i),onAddEvent:A(l),onDeleteEvent:A(v)},null,8,["title","eventos","start","end","onEditEvent","onAddEvent","onDeleteEvent"]))),128))],512),[[G,!A(t)&&!A(o)]])])}}},pe=M(me,[["__scopeId","data-v-bfd87c15"]]);export{pe as default};
